//ID 899 tem 14 anos mas vai ficar fora da analise

data=data[data$ID!=899,]

baseline=data[(is.na(data$Exclusão) | data$Exclusão=="Transferido") & !grepl("^C",data$Turma) & !is.na(data$ZIMC_0),]

baseline8years_male=subset(baseline,baseline$DN_Calc==8 & baseline$Sexo==1)
baseline8years_female=subset(baseline,baseline$DN_Calc==8 & baseline$Sexo==2)
baseline9years_male=subset(baseline,baseline$DN_Calc==9 & baseline$Sexo==1)
baseline9years_female=subset(baseline,baseline$DN_Calc==9 & baseline$Sexo==2)
baseline10years_male=subset(baseline,baseline$DN_Calc==10 & baseline$Sexo==1)
baseline10years_female=subset(baseline,baseline$DN_Calc==10 & baseline$Sexo==2)
baseline11years_male=subset(baseline,baseline$DN_Calc==11 & baseline$Sexo==1)
baseline11years_female=subset(baseline,baseline$DN_Calc==11 & baseline$Sexo==2)
baseline12years_male=subset(baseline,baseline$DN_Calc==12 & baseline$Sexo==1)
baseline12years_female=subset(baseline,baseline$DN_Calc==12 & baseline$Sexo==2)

//data to imputate missing anthropometric data

baseline8years_male_anthro = baseline8years_male[!is.na(baseline8years_male$C._Cintura_1) & !is.na(baseline8years_male$C._Quadril_1) & !is.na(baseline8years_male$C._Pescoco_1) | baseline8years_male$ID==774,]

baseline8years_female_anthro = baseline8years_female[!is.na(baseline8years_female$C._Cintura_1) & !is.na(baseline8years_female$C._Quadril_1) & !is.na(baseline8years_female$C._Pescoco_1) | baseline8years_female$ID==770,]
baseline8years_female_anthro[baseline8years_female_anthro$ID==770,]$C_Cintura_1=NA

baseline9years_male_anthro = baseline9years_male[!is.na(baseline9years_male$C._Cintura_1) & !is.na(baseline9years_male$C._Quadril_1) & !is.na(baseline9years_male$C._Pescoco_1) | baseline9years_male$ID==487,]

library(readr)
data <- read_csv("data/Banco_Geral_15022017.csv", col_types = cols(DN = col_date(format = "%m/%d/%Y"), Data_CP = col_date(format = "%m/%d/%Y"), Recrutamento = col_date(format = "%m/%d/%Y")))

data$DN_Calc=as.integer(floor(as.numeric(difftime(data$Recrutamento, data$DN, units="days")/365)))
7year_fix=c(422,490,502,510,648,687,915)

data[data$ID==422,]$DN_Calc=8
data[data$ID==490,]$DN_Calc=8
data[data$ID==502,]$DN_Calc=8
data[data$ID==510,]$DN_Calc=8
data[data$ID==648,]$DN_Calc=8
data[data$ID==687,]$DN_Calc=8
data[data$ID==915,]$DN_Calc=8

//ID 899 tem 14 anos mas vai ficar fora da analise

data=data[data$ID!=899,]

baseline=data[(is.na(data$Exclusão) | data$Exclusão=="Transferido") & !grepl("^C",data$Turma) & !is.na(data$ZIMC_0),]

baseline8years_male=subset(baseline,baseline$DN_Calc==8 & baseline$Sexo==1)
baseline8years_female=subset(baseline,baseline$DN_Calc==8 & baseline$Sexo==2)
baseline9years_male=subset(baseline,baseline$DN_Calc==9 & baseline$Sexo==1)
baseline9years_female=subset(baseline,baseline$DN_Calc==9 & baseline$Sexo==2)
baseline10years_male=subset(baseline,baseline$DN_Calc==10 & baseline$Sexo==1)
baseline10years_female=subset(baseline,baseline$DN_Calc==10 & baseline$Sexo==2)
baseline11years_male=subset(baseline,baseline$DN_Calc==11 & baseline$Sexo==1)
baseline11years_female=subset(baseline,baseline$DN_Calc==11 & baseline$Sexo==2)
baseline12years_male=subset(baseline,baseline$DN_Calc==12 & baseline$Sexo==1)
baseline12years_female=subset(baseline,baseline$DN_Calc==12 & baseline$Sexo==2)

//data to imputate missing anthropometric data

baseline8years_male_anthro = baseline8years_male[!is.na(baseline8years_male$C._Cintura_1) & !is.na(baseline8years_male$C._Quadril_1) & !is.na(baseline8years_male$C._Pescoço_1) | baseline8years_male$ID==774,]

baseline8years_female_anthro = baseline8years_female[!is.na(baseline8years_female$C._Cintura_1) & !is.na(baseline8years_female$C._Quadril_1) & !is.na(baseline8years_female$C._Pescoço_1) | baseline8years_female$ID==770,]
baseline8years_female_anthro[baseline8years_female_anthro$ID==770,]$C_Cintura_1=NA

baseline9years_male_anthro = baseline9years_male[!is.na(baseline9years_male$C._Cintura_1) & !is.na(baseline9years_male$C._Quadril_1) & !is.na(baseline9years_male$C._Pescoço_1) | baseline9years_male$ID==487,]

library(readr)
data <- read_csv("data/Banco_Geral_15022017.csv", col_types = cols(DN = col_date(format = "%m/%d/%Y"), Data_CP = col_date(format = "%m/%d/%Y"), Recrutamento = col_date(format = "%m/%d/%Y")))

data$DN_Calc=as.integer(floor(as.numeric(difftime(data$Recrutamento, data$DN, units="days")/365)))
7year_fix=c(422,490,502,510,648,687,915)

data[data$ID==422,]$DN_Calc=8
data[data$ID==490,]$DN_Calc=8
data[data$ID==502,]$DN_Calc=8
data[data$ID==510,]$DN_Calc=8
data[data$ID==648,]$DN_Calc=8
data[data$ID==687,]$DN_Calc=8
data[data$ID==915,]$DN_Calc=8


data=data[data$ID!=899,]

baseline=data[(is.na(data$Exclusão) | data$Exclusão=="Transferido") & !grepl("^C",data$Turma) & !is.na(data$ZIMC_0),]

baseline8years_male=subset(baseline,baseline$DN_Calc==8 & baseline$Sexo==1)
baseline8years_female=subset(baseline,baseline$DN_Calc==8 & baseline$Sexo==2)
baseline9years_male=subset(baseline,baseline$DN_Calc==9 & baseline$Sexo==1)
baseline9years_female=subset(baseline,baseline$DN_Calc==9 & baseline$Sexo==2)
baseline10years_male=subset(baseline,baseline$DN_Calc==10 & baseline$Sexo==1)
baseline10years_female=subset(baseline,baseline$DN_Calc==10 & baseline$Sexo==2)
baseline11years_male=subset(baseline,baseline$DN_Calc==11 & baseline$Sexo==1)
baseline11years_female=subset(baseline,baseline$DN_Calc==11 & baseline$Sexo==2)
baseline12years_male=subset(baseline,baseline$DN_Calc==12 & baseline$Sexo==1)
baseline12years_female=subset(baseline,baseline$DN_Calc==12 & baseline$Sexo==2)


baseline8years_male_anthro = baseline8years_male[!is.na(baseline8years_male$C._Cintura_1) & !is.na(baseline8years_male$C._Quadril_1) & !is.na(baseline8years_male$C._Pescoço_1) | baseline8years_male$ID==774,]

baseline8years_female_anthro = baseline8years_female[!is.na(baseline8years_female$C._Cintura_1) & !is.na(baseline8years_female$C._Quadril_1) & !is.na(baseline8years_female$C._Pescoço_1) | baseline8years_female$ID==770,]
baseline8years_female_anthro[baseline8years_female_anthro$ID==770,]$C_Cintura_1=NA

baseline9years_male_anthro = baseline9years_male[!is.na(baseline9years_male$C._Cintura_1) & !is.na(baseline9years_male$C._Quadril_1) & !is.na(baseline9years_male$C._Pescoço_1) | baseline9years_male$ID==487,]

plot_missing_data_anthro <- function(data_input) {
    columns1=c("ZIMC_0","Peso_0","Altura_0","C._Quadril_1","C._Cintura_1","C._Pescoço_1","Colesterol_Total_1")
    data_columns=subset(data_input,select=columns1)
    title=paste("Missing data - Baseline - ",years," years - ",gender)
    aggr(data_columns,col=c('navyblue','red'), numbers=TRUE, sortVars=TRUE, labels=names(data_columns), cex.axis=.7, gap=3, ylab=c(title,"Pattern"))
}

plot_missing_data_anthro(baseline8years_male_anthro)
plot_missing_data_anthro <- function(data_input, years, gender) {
    columns1=c("ZIMC_0","Peso_0","Altura_0","C._Quadril_1","C._Cintura_1","C._Pescoço_1","Colesterol_Total_1")
    data_columns=subset(data_input,select=columns1)
    title=paste("Missing data - Baseline - ",years," years - ",gender)
    aggr(data_columns,col=c('navyblue','red'), numbers=TRUE, sortVars=TRUE, labels=names(data_columns), cex.axis=.7, gap=3, ylab=c(title,"Pattern"))
}

plot_missing_data_anthro(baseline8years_male_anthro)
plot_missing_data_anthro(baseline8years_male_anthro,8,"male")
library(mice)
library(VIM)
plot_missing_data_anthro(baseline8years_male_anthro,8,"male")
plot_missing_data_anthro <- function(data_input, years, gender) {
    columns1=c("ZIMC_0","Peso_0","Altura_0","C._Quadril_1","C._Cintura_1","C._Pescoço_1")
    data_columns=subset(data_input,select=columns1)
    title=paste("Missing data - Baseline - ",years," years - ",gender)
    aggr(data_columns,col=c('navyblue','red'), numbers=TRUE, sortVars=TRUE, labels=names(data_columns), cex.axis=.7, gap=3, ylab=c(title,"Pattern"))
}

plot_missing_data_anthro(baseline8years_male_anthro,8,"male")
plot_missing_data_anthro(baseline8years_female_anthro,8,"female")
plot_missing_data_anthro(baseline9years_male_anthro,9,"male")
colnames=names(data)
library(hash)
models=hash(keys=colnames,values="")
models[["C_Cintura_1"]]="pmm"
models[["C_Quadril_1"]]="pmm"
models[["C_Pescoco_1"]]="pmm"

models
colnames
models
colnames
colnames
length(colnames))
length(colnames)
colnames[286]
colnames[1]
colnames=names(data)
library(hash)
inv_index=hash(keys=colnames,values=1)
mice_methods=hash(keys=colnames,values="")

for (idx in 1:length(colnames)) {
    curname=colnames[idx]
    inv_index[[curname]]=idx
}

inv_index
colnames
class(colnames)
a=character(10)
a
a[0]
a[1]
a[1]="asdasdas"
a
mice_methods[["C._Cintura_1"]]="pmm"
mice_methods[["C._Quadril_1"]]="pmm"
mice_methods[["C._Pescoço_1"]]="pmm"

output=character(length(colnames))

for (idx in 1:length(colnames)) {
    curname=colnames[idx]
    method_name=mice_methods[[curname]]
    output[idx]=method_name
}
output
gen_mice_array <- function(mice_hash, colnames) {
    output=character(length(colnames))
    for (idx in 1:length(colnames)) {
        curname=colnames[idx]
        method_name=mice_methods[[curname]]
        output[idx]=method_name
    }
    return output
}
gen_mice_array <- function(mice_hash, colnames) {
    output=character(length(colnames))
    for (idx in 1:length(colnames)) {
        curname=colnames[idx]
        method_name=mice_methods[[curname]]
        output[idx]=method_name
    }
    return(output)
}
colnames=names(data)
library(hash)
mice_methods=hash(keys=colnames,values="")

mice_methods[["C._Cintura_1"]]="pmm"
mice_methods[["C._Quadril_1"]]="pmm"
mice_methods[["C._Pescoço_1"]]="pmm"
mice_array=gen_mice_array(mice_methods, colnames)
mice_array
impBaseline8years_male_anthro = mice(baseline8years_male_anthro, meth=mice_array)
baseline8years_male_anthro$"C._Pescoço_1"
class(baseline8years_male_anthro$"C._Pescoço_1")
class(data$"C._Pescoço_1")
data$"C._Pescoço_1"
impBaseline8years_male_anthro = mice(baseline8years_male_anthro, meth=mice_array)
library(readr)
data <- read_csv("data/Banco_Geral_15022017.csv", col_types = cols(DN = col_date(format = "%m/%d/%Y"), Data_CP = col_date(format = "%m/%d/%Y"), Recrutamento = col_date(format = "%m/%d/%Y")))

data$DN_Calc=as.integer(floor(as.numeric(difftime(data$Recrutamento, data$DN, units="days")/365)))
7year_fix=c(422,490,502,510,648,687,915)

data[data$ID==422,]$DN_Calc=8
data[data$ID==490,]$DN_Calc=8
data[data$ID==502,]$DN_Calc=8
data[data$ID==510,]$DN_Calc=8
data[data$ID==648,]$DN_Calc=8
data[data$ID==687,]$DN_Calc=8
data[data$ID==915,]$DN_Calc=8


data=data[data$ID!=899,]

baseline=data[(is.na(data$Exclusão) | data$Exclusão=="Transferido") & !grepl("^C",data$Turma) & !is.na(data$ZIMC_0),]

baseline8years_male=subset(baseline,baseline$DN_Calc==8 & baseline$Sexo==1)
baseline8years_female=subset(baseline,baseline$DN_Calc==8 & baseline$Sexo==2)
baseline9years_male=subset(baseline,baseline$DN_Calc==9 & baseline$Sexo==1)
baseline9years_female=subset(baseline,baseline$DN_Calc==9 & baseline$Sexo==2)
baseline10years_male=subset(baseline,baseline$DN_Calc==10 & baseline$Sexo==1)
baseline10years_female=subset(baseline,baseline$DN_Calc==10 & baseline$Sexo==2)
baseline11years_male=subset(baseline,baseline$DN_Calc==11 & baseline$Sexo==1)
baseline11years_female=subset(baseline,baseline$DN_Calc==11 & baseline$Sexo==2)
baseline12years_male=subset(baseline,baseline$DN_Calc==12 & baseline$Sexo==1)
baseline12years_female=subset(baseline,baseline$DN_Calc==12 & baseline$Sexo==2)

data$"C._Pescoco_1"
baseline8years_male_anthro = baseline8years_male[!is.na(baseline8years_male$C._Cintura_1) & !is.na(baseline8years_male$C._Quadril_1) & !is.na(baseline8years_male$C._Pescoco_1) | baseline8years_male$ID==774,]

baseline8years_female_anthro = baseline8years_female[!is.na(baseline8years_female$C._Cintura_1) & !is.na(baseline8years_female$C._Quadril_1) & !is.na(baseline8years_female$C._Pescoco_1) | baseline8years_female$ID==770,]
baseline8years_female_anthro[baseline8years_female_anthro$ID==770,]$C_Cintura_1=NA

baseline9years_male_anthro = baseline9years_male[!is.na(baseline9years_male$C._Cintura_1) & !is.na(baseline9years_male$C._Quadril_1) & !is.na(baseline9years_male$C._Pescoco_1) | baseline9years_male$ID==487,]




gen_mice_array <- function(mice_hash, colnames) {
    output=character(length(colnames))
    for (idx in 1:length(colnames)) {
        curname=colnames[idx]
        method_name=mice_methods[[curname]]
        output[idx]=method_name
    }
    return(output)
}


colnames=names(data)
library(hash)
mice_methods=hash(keys=colnames,values="")

mice_methods[["C._Cintura_1"]]="pmm"
mice_methods[["C._Quadril_1"]]="pmm"
mice_methods[["C._Pescoco_1"]]="pmm"

mice_array=gen_mice_array(mice_methods, colnames)

impBaseline8years_male_anthro = mice(baseline8years_male_anthro, meth=mice_array)
subdata=subset(baseline8years_male_anthro, select=c("C.Cintura_1, C._Quadril_1, C._Pescoco_1"))
subdata=subset(baseline8years_male_anthro, select=c("C.Cintura_1", "C._Quadril_1", "C._Pescoco_1"))
subdata=subset(baseline8years_male_anthro, select=c("C._Cintura_1", "C._Quadril_1", "C._Pescoco_1"))
mice(subdata)
subdata=subset(baseline8years_male_anthro, select=c("C._Cintura_1", "C._Quadril_1", "C._Pescoco_1"))
baseline8years_male_anthro = subset(baseline8years_male[!is.na(baseline8years_male$C._Cintura_1) & !is.na(baseline8years_male$C._Quadril_1) & !is.na(baseline8years_male$C._Pescoco_1) | baseline8years_male$ID==774,], select=c("C._Cintura_1", "C._Quadril_1", "C._Pescoco_1"))

baseline8years_female_anthro = baseline8years_female[!is.na(baseline8years_female$C._Cintura_1) & !is.na(baseline8years_female$C._Quadril_1) & !is.na(baseline8years_female$C._Pescoco_1) | baseline8years_female$ID==770,]
baseline8years_female_anthro[baseline8years_female_anthro$ID==770,]$C_Cintura_1=NA

baseline8years_female_anthro=subset(baseline8years_female_anthro, select=c("C._Cintura_1", "C._Quadril_1", "C._Pescoco_1"))

baseline9years_male_anthro = subset(baseline9years_male[!is.na(baseline9years_male$C._Cintura_1) & !is.na(baseline9years_male$C._Quadril_1) & !is.na(baseline9years_male$C._Pescoco_1) | baseline9years_male$ID==487,],select=c("C._Cintura_1", "C._Quadril_1", "C._Pescoco_1"))
baseline8years_male_anthro
baseline8years_female_anthro
baseline9years_male_anthro
impBaseline8years_male_anthro = mice(baseline8years_male_anthro)
impBaseline8years_male_anthro = mice(baseline8years_male_anthro)
impBaseline8years_female_anthro = mice(baseline8years_female_anthro)
impBaseline9years_male_anthro = mice(baseline9years_male_anthro)
densityplot(impBaseline8years_male_anthro)
library(mice)
library(lattice)
densityplot(impBaseline8years_male_anthro)
impBaseline8years_male_anthro
summary(impBaseline8years_male_anthro)
densityplot(impBaseline8years_male_anthro)
help(densityplot)
stripplot(impBaseline8years_male_anthro)
stripplot(impBaseline8years_female_anthro)
stripplot(impBaseline9years_male_anthro)
impBaseline8years_male_anthro = mice(baseline8years_male_anthro, m=10,maxit=300)
impBaseline8years_female_anthro = mice(baseline8years_female_anthro, m=10, maxit=300)
impBaseline9years_male_anthro = mice(baseline9years_male_anthro, m=10, maxit=300)
stripplot(impBaseline8years_male_anthro)
stripplot(impBaseline8years_female_anthro)
stripplot(impBaseline9years_male_anthro)
stripplot(impBaseline8years_male_anthro)
baseline8years_male_anthro = subset(baseline8years_male[!is.na(baseline8years_male$C._Cintura_1) & !is.na(baseline8years_male$C._Quadril_1) & !is.na(baseline8years_male$C._Pescoco_1) | baseline8years_male$ID==774,], select=c("C._Cintura_1", "C._Quadril_1", "C._Pescoco_1","Colesterol_Total_1"))

baseline8years_female_anthro = baseline8years_female[!is.na(baseline8years_female$C._Cintura_1) & !is.na(baseline8years_female$C._Quadril_1) & !is.na(baseline8years_female$C._Pescoco_1) | baseline8years_female$ID==770,]
baseline8years_female_anthro[baseline8years_female_anthro$ID==770,]$C_Cintura_1=NA

baseline8years_female_anthro=subset(baseline8years_female_anthro, select=c("C._Cintura_1", "C._Quadril_1", "C._Pescoco_1","Colesterol_Total_1"))

baseline9years_male_anthro = subset(baseline9years_male[!is.na(baseline9years_male$C._Cintura_1) & !is.na(baseline9years_male$C._Quadril_1) & !is.na(baseline9years_male$C._Pescoco_1) | baseline9years_male$ID==487,],select=c("C._Cintura_1", "C._Quadril_1", "C._Pescoco_1","Colesterol_Total_1"))

md.pattern(baseline8years_male_anthro)
baseline8years_male_anthro$Colesterol_Total_1
md.pattern(baseline8years_female_anthro)
md.pattern(baseline9years_male_anthro)
baseline8years_male_anthro = subset(baseline8years_male[!is.na(baseline8years_male$C._Cintura_1) & !is.na(baseline8years_male$C._Quadril_1) & !is.na(baseline8years_male$C._Pescoco_1) | baseline8years_male$ID==774,], select=c("C._Cintura_1", "C._Quadril_1", "C._Pescoco_1","ZIMC_0"))

baseline8years_female_anthro = baseline8years_female[!is.na(baseline8years_female$C._Cintura_1) & !is.na(baseline8years_female$C._Quadril_1) & !is.na(baseline8years_female$C._Pescoco_1) | baseline8years_female$ID==770,]
baseline8years_female_anthro[baseline8years_female_anthro$ID==770,]$C_Cintura_1=NA

baseline8years_female_anthro=subset(baseline8years_female_anthro, select=c("C._Cintura_1", "C._Quadril_1", "C._Pescoco_1","ZIMC_0"))

baseline9years_male_anthro = subset(baseline9years_male[!is.na(baseline9years_male$C._Cintura_1) & !is.na(baseline9years_male$C._Quadril_1) & !is.na(baseline9years_male$C._Pescoco_1) | baseline9years_male$ID==487,],select=c("C._Cintura_1", "C._Quadril_1", "C._Pescoco_1","ZIMC_0"))
md.pattern(baseline8years_female_anthro)
md.pattern(baseline8years_male_anthro)
md.pattern(baseline9years_male_anthro)
impBaseline8years_male_anthro = mice(baseline8years_male_anthro)
impBaseline8years_female_anthro = mice(baseline8years_female_anthro)
impBaseline9years_male_anthro = mice(baseline9years_male_anthro)

impBaseline8years_male_anthro = mice(baseline8years_male_anthro, m=50, maxit=300)
impBaseline8years_female_anthro = mice(baseline8years_female_anthro, m=50, maxit=300)
impBaseline9years_male_anthro = mice(baseline9years_male_anthro, m=50, maxit=300)
modelFit8yrs_male_anthro=with(impBaseline8years_male_anthro,lm(ZIMC_0 ~ C._Cintura_1+C._Quadril_1+C._Pescoco_1))
summary(pool(modelFit8yrs_male_anthro))
modelFit8yrs_male_anthro=with(impBaseline8years_male_anthro,lm(ZIMC_0 ~ C._Cintura_1+C._Quadril_1+C._Pescoco_1))
summary(pool(modelFit8yrs_male_anthro))
modelFit8yrs_female_anthro=with(impBaseline8years_female_anthro,lm(ZIMC_0 ~ C._Cintura_1+C._Quadril_1+C._Pescoco_1))
summary(pool(modelFit8yrs_female_anthro))
help(lm)
modelFit9yrs_male_anthro=with(impBaseline9years_male_anthro,lm(ZIMC_0 ~ C._Cintura_1+C._Quadril_1+C._Pescoco_1))
summary(pool(modelFit9yrs_male_anthro))
class(pool(modelFit9yrs_male_anthro))
help(mipo)
help(mira)
complete8years_male_anthro=complete(impBaseline8years_male_anthro)
complete8years_female_anthro=complete(impBaseline8years_female_anthro)
complete9years_male_anthro=complete(impBaseline9years_male_anthro)
complete8years_male_anthro
help(mira)
baseline8years_male_anthro
baseline8years_male_anthro$C._Pescoco_1
baseline8years_male_anthro
baseline8years_male_anthro[29,]
complete8years_male_anthro[29,]
impBaseline8years_male_anthro = mice(baseline8years_male_anthro, m=50, maxit=300)
impBaseline8years_female_anthro = mice(baseline8years_female_anthro, m=50, maxit=300)
impBaseline9years_male_anthro = mice(baseline9years_male_anthro, m=50, maxit=300)

modelFit8yrs_male_anthro=with(impBaseline8years_male_anthro,lm(ZIMC_0 ~ C._Cintura_1+C._Quadril_1+C._Pescoco_1))
pool_8years_male_anthro=pool(modelFit8yrs_male_anthro)
summary(pool_8years_male_anthro)

modelFit8yrs_female_anthro=with(impBaseline8years_female_anthro,lm(ZIMC_0 ~ C._Cintura_1+C._Quadril_1+C._Pescoco_1))
pool_8years_female_anthro=pool(modelFit8yrs_female_anthro)
summary(pool_8years_female_anthro)

modelFit9yrs_male_anthro=with(impBaseline9years_male_anthro,lm(ZIMC_0 ~ C._Cintura_1+C._Quadril_1+C._Pescoco_1))
pool_9years_male_anthro=pool(modelFit9yrs_male_anthro)
summary(pool_9years_male_anthro)
baseline8years_male_anthro = subset(baseline8years_male[!is.na(baseline8years_male$C._Cintura_1) & !is.na(baseline8years_male$C._Quadril_1) & !is.na(baseline8years_male$C._Pescoco_1) | baseline8years_male$ID==774,], select=c("C._Cintura_1", "C._Quadril_1", "C._Pescoco_1","Peso_0","Altura_0"))
baseline8years_female_anthro = baseline8years_female[!is.na(baseline8years_female$C._Cintura_1) & !is.na(baseline8years_female$C._Quadril_1) & !is.na(baseline8years_female$C._Pescoco_1) | baseline8years_female$ID==770,]
baseline8years_female_anthro[baseline8years_female_anthro$ID==770,]$C_Cintura_1=NA

baseline8years_female_anthro=subset(baseline8years_female_anthro, select=c("C._Cintura_1", "C._Quadril_1", "C._Pescoco_1","Peso_0","Altura_0"))

baseline9years_male_anthro = subset(baseline9years_male[!is.na(baseline9years_male$C._Cintura_1) & !is.na(baseline9years_male$C._Quadril_1) & !is.na(baseline9years_male$C._Pescoco_1) | baseline9years_male$ID==487,],select=c("C._Cintura_1", "C._Quadril_1", "C._Pescoco_1","Peso_0","Altura_0"))
md.pattern(baseline8years_male_anthro)
baseline8years_male_anthro
baseline8years_male_anthro$C._Pescoco_1
baseline8years_male_anthro[30,]
baseline8years_male_anthro[29,]
baseline8years_male_anthro$imc=baseline8years_male_anthro$Peso_0/(baseline8years_male_anthro$Altura_0/100)^2
baseline8years_male_anthro[29,]
baseline8years_male_anthro[29,]
baseline8years_male_anthro=subset(baseline8years_male_anthro,select=c("C._Cintura_1","C._Quadril_1","C._Pescoco_1","imc"))
baseline8years_male_anthro[29,]
impBaseline8years_male_anthro = mice(baseline8years_male_anthro, m=50, maxit=300)
baseline8years_male_anthro
modelFit8yrs_male_anthro=with(impBaseline8years_male_anthro,lm(imc ~ C._Cintura_1+C._Quadril_1+C._Pescoco_1))
pool_8years_male_anthro=pool(modelFit8yrs_male_anthro)
summary(pool_8years_male_anthro)
baseline8years_male=subset(baseline,baseline$DN_Calc==8 & baseline$Sexo==1)
baseline8years_male_anthro = subset(baseline8years_male[!is.na(baseline8years_male$C._Cintura_1) & !is.na(baseline8years_male$C._Quadril_1) & !is.na(baseline8years_male$C._Pescoco_1) | baseline8years_male$ID==774,], select=c("C._Cintura_1", "C._Quadril_1", "C._Pescoco_1","Perc_Gordura_1"))
baseline8years_male_anthro[29,]
md.pattern(baseline8years_male_anthro)
impBaseline8years_male_anthro = mice(baseline8years_male_anthro, m=50, maxit=300)
modelFit8yrs_male_anthro=with(impBaseline8years_male_anthro,lm(Perc_Gordura_1~ C._Cintura_1+C._Quadril_1+C._Pescoco_1))
pool_8years_male_anthro=pool(modelFit8yrs_male_anthro)
summary(pool_8years_male_anthro)

baseline8years_female=subset(baseline,baseline$DN_Calc==8 & baseline$Sexo==2)
baseline8years_female_anthro = baseline8years_female[!is.na(baseline8years_female$C._Cintura_1) & !is.na(baseline8years_female$C._Quadril_1) & !is.na(baseline8years_female$C._Pescoco_1) | baseline8years_female$ID==770,]
baseline8years_female_anthro[baseline8years_female_anthro$ID==770,]$C_Cintura_1=NA
baseline8years_female_anthro=subset(baseline8years_female_anthro, select=c("C._Cintura_1", "C._Quadril_1", "C._Pescoco_1","Perc_Gordura_1"))

baseline8years_female_anthro
md.pattern(baseline8years_female_anthro)
md.pattern(baseline8years_male_anthro)
impBaseline8years_female_anthro = mice(baseline8years_female_anthro, m=50, maxit=300)
modelFit8yrs_female_anthro=with(impBaseline8years_female_anthro,lm(ZIMC_0 ~ C._Cintura_1+C._Quadril_1+C._Pescoco_1))
pool_8years_female_anthro=pool(modelFit8yrs_female_anthro)
summary(pool_8years_female_anthro)

modelFit8yrs_female_anthro=with(impBaseline8years_female_anthro,lm(Perc_Gordura_1~ C._Cintura_1+C._Quadril_1+C._Pescoco_1))
pool_8years_female_anthro=pool(modelFit8yrs_female_anthro)
summary(pool_8years_female_anthro)
help(lm)
lm(Perc_Gordura_1~ C._Cintura_1+C._Quadril_1+C._Pescoco_1, baseline8years_female_anthro)
modelFit8yrs_female_anthro=with(impBaseline8years_female_anthro,lm(Perc_Gordura_1~ C._Cintura_1+C._Quadril_1+C._Pescoco_1))
pool_8years_female_anthro=pool(modelFit8yrs_female_anthro)
class(pool_8years_female_anthro)
help(mipo)
help(mira)
help(pool)
help(with)
help(with.mids)
plot(impBaseline8years_male_anthro)
impBaseline8years_male_anthro$C._Pescoco_1
impBaseline8years_male_anthro$imp$C._Pescoco_1
impBaseline8years_male_anthro$imp$meth
impBaseline8years_male_anthro$meth
baseline8years_male_anthro
impBaseline8years_male_anthro = mice(baseline8years_male_anthro, m=50, maxit=300, method=c("","","norm",""))

densitityplot(impBaseline8years_male_anthro)
densityplot(impBaseline8years_male_anthro)
plot(impBaseline8years_male_anthro)
impBaseline8years_male_anthro = mice(baseline8years_male_anthro, m=5, maxit=300, method=c("","","norm",""))

plot(impBaseline8years_male_anthro)
plot(impBaseline8years_female_anthro)
impBaseline8years_male_anthro = mice(baseline8years_male_anthro, m=5, maxit=20, method=c("","","norm",""))
plot(impBaseline8years_male_anthro)
densityplot(impBaseline8years_male_anthro)
impBaseline8years_male_anthro
print(impBaseline8years_male_anthro)
baseline8years_male_anthro = subset(baseline8years_male[!is.na(baseline8years_male$C._Cintura_1) & !is.na(baseline8years_male$C._Quadril_1) & !is.na(baseline8years_male$C._Pescoco_1) | baseline8years_male$ID==774,], select=c("C._Cintura_1", "C._Quadril_1", "C._Pescoco_1","Perc_Gordura_1","Peso_0","Altura_0","Gordura_Kg_1","MM_Kg_1","TMB_1","Água_corpo_(l)_1","Perc_Peso_do_corpo_1","Perc_MM_1","Bioresistência_1","Reatância_1"))
md.pattern(baseline8years_male_anthro)
impBaseline8years_male_anthro = mice(baseline8years_male_anthro, m=5, maxit=20, method="norm")
densityplot(impBaseline8years_male_anthro)
plot(impBaseline8years_male_anthro)
summary(impBaseline8years_male_anthro)
modelFit8yrs_male_anthro=with(impBaseline8years_male_anthro,lm(Bioresistência_1 ~ C._Cintura_1+C._Quadril_1+C._Pescoco_1))
pool_8years_male_anthro=pool(modelFit8yrs_male_anthro)
summary(pool_8years_male_anthro)
modelFit8yrs_male_anthro=with(impBaseline8years_male_anthro,lm(Bioresistência_1 ~ C._Cintura_1+C._Quadril_1+C._Pescoco_1+Água_corpo_(l)_1))
pool_8years_male_anthro=pool(modelFit8yrs_male_anthro)
summary(pool_8years_male_anthro)
modelFit8yrs_male_anthro=with(impBaseline8years_male_anthro,lm(Bioresistência_1 ~ C._Cintura_1+C._Quadril_1+C._Pescoco_1+"Água_corpo_(l)_1"))
pool_8years_male_anthro=pool(modelFit8yrs_male_anthro)
summary(pool_8years_male_anthro)
q()
y
library(readr)
data <- read_csv("data/Banco_Geral_15022017.csv", col_types = cols(DN = col_date(format = "%m/%d/%Y"), Data_CP = col_date(format = "%m/%d/%Y"), Recrutamento = col_date(format = "%m/%d/%Y")))


library(plyr)
rename(data, c("Água_corpo_(l)_1"="Agua_corpo_l_1","Bioresistência_1"="Bioresistencia_1","Reatância_1"="Reatancia_1"))

data$DN_Calc=as.integer(floor(as.numeric(difftime(data$Recrutamento, data$DN, units="days")/365)))
7year_fix=c(422,490,502,510,648,687,915)

data[data$ID==422,]$DN_Calc=8
data[data$ID==490,]$DN_Calc=8
data[data$ID==502,]$DN_Calc=8
data[data$ID==510,]$DN_Calc=8
data[data$ID==648,]$DN_Calc=8
data[data$ID==687,]$DN_Calc=8
data[data$ID==915,]$DN_Calc=8

#ID 899 tem 14 anos mas vai ficar fora da analise

data=data[data$ID!=899,]

baseline=data[(is.na(data$Exclusão) | data$Exclusão=="Transferido") & !grepl("^C",data$Turma) & !is.na(data$ZIMC_0),]

baseline8years_male=subset(baseline,baseline$DN_Calc==8 & baseline$Sexo==1)
baseline8years_female=subset(baseline,baseline$DN_Calc==8 & baseline$Sexo==2)
baseline9years_male=subset(baseline,baseline$DN_Calc==9 & baseline$Sexo==1)
baseline9years_female=subset(baseline,baseline$DN_Calc==9 & baseline$Sexo==2)
baseline10years_male=subset(baseline,baseline$DN_Calc==10 & baseline$Sexo==1)
baseline10years_female=subset(baseline,baseline$DN_Calc==10 & baseline$Sexo==2)
baseline11years_male=subset(baseline,baseline$DN_Calc==11 & baseline$Sexo==1)
baseline11years_female=subset(baseline,baseline$DN_Calc==11 & baseline$Sexo==2)
baseline12years_male=subset(baseline,baseline$DN_Calc==12 & baseline$Sexo==1)
baseline12years_female=subset(baseline,baseline$DN_Calc==12 & baseline$Sexo==2)

baseline8years_male_anthro = subset(baseline8years_male[!is.na(baseline8years_male$C._Cintura_1) & !is.na(baseline8years_male$C._Quadril_1) & !is.na(baseline8years_male$C._Pescoco_1) | baseline8years_male$ID==774,], select=c("C._Cintura_1", "C._Quadril_1", "C._Pescoco_1","Perc_Gordura_1","Peso_0","Altura_0","Gordura_Kg_1","MM_Kg_1","TMB_1","Agua_corpo_l_1","Perc_Peso_do_corpo_1","Perc_MM_1","Bioresistencia_1","Reatancia_1"))

baseline8years_female_anthro = baseline8years_female[!is.na(baseline8years_female$C._Cintura_1) & !is.na(baseline8years_female$C._Quadril_1) & !is.na(baseline8years_female$C._Pescoco_1) | baseline8years_female$ID==770,]
baseline8years_female_anthro[baseline8years_female_anthro$ID==770,]$C_Cintura_1=NA
baseline8years_female_anthro=subset(baseline8years_female_anthro, select=c("C._Cintura_1", "C._Quadril_1", "C._Pescoco_1","Perc_Gordura_1","Peso_0","Altura_0","Gordura_Kg_1","MM_Kg_1","TMB_1","Agua_corpo_l_1","Perc_Peso_do_corpo_1","Perc_MM_1","Bioresistencia_1","Reatancia_1"))

baseline9years_male_anthro = subset(baseline9years_male[!is.na(baseline9years_male$C._Cintura_1) & !is.na(baseline9years_male$C._Quadril_1) & !is.na(baseline9years_male$C._Pescoco_1) | baseline9years_male$ID==487,],select=c("C._Cintura_1", "C._Quadril_1", "C._Pescoco_1","Perc_Gordura_1","Peso_0","Altura_0","Gordura_Kg_1","MM_Kg_1","TMB_1","Agua_corpo_l_1","Perc_Peso_do_corpo_1","Perc_MM_1","Bioresistencia_1","Reatancia_1"))

rename(data, c("Água_corpo_(l)_1"="Agua_corpo_l_1","Bioresistência_1"="Bioresistencia_1","Reatância_1"="Reatancia_1"))

data$"Agua_corpo_l_1"
data$"Água_corpo_l_1"
data$"Água_corpo_(l)_1"
library(readr)
data <- read_csv("data/Banco_Geral_15022017.csv", col_types = cols(DN = col_date(format = "%m/%d/%Y"), Data_CP = col_date(format = "%m/%d/%Y"), Recrutamento = col_date(format = "%m/%d/%Y")))

data$DN_Calc=as.integer(floor(as.numeric(difftime(data$Recrutamento, data$DN, units="days")/365)))
7year_fix=c(422,490,502,510,648,687,915)

data[data$ID==422,]$DN_Calc=8
data[data$ID==490,]$DN_Calc=8
data[data$ID==502,]$DN_Calc=8
data[data$ID==510,]$DN_Calc=8
data[data$ID==648,]$DN_Calc=8
data[data$ID==687,]$DN_Calc=8
data[data$ID==915,]$DN_Calc=8

#ID 899 tem 14 anos mas vai ficar fora da analise

data=data[data$ID!=899,]

baseline=data[(is.na(data$Exclusão) | data$Exclusão=="Transferido") & !grepl("^C",data$Turma) & !is.na(data$ZIMC_0),]

baseline8years_male=subset(baseline,baseline$DN_Calc==8 & baseline$Sexo==1)
baseline8years_female=subset(baseline,baseline$DN_Calc==8 & baseline$Sexo==2)
baseline9years_male=subset(baseline,baseline$DN_Calc==9 & baseline$Sexo==1)
baseline9years_female=subset(baseline,baseline$DN_Calc==9 & baseline$Sexo==2)
baseline10years_male=subset(baseline,baseline$DN_Calc==10 & baseline$Sexo==1)
baseline10years_female=subset(baseline,baseline$DN_Calc==10 & baseline$Sexo==2)
baseline11years_male=subset(baseline,baseline$DN_Calc==11 & baseline$Sexo==1)
baseline11years_female=subset(baseline,baseline$DN_Calc==11 & baseline$Sexo==2)
baseline12years_male=subset(baseline,baseline$DN_Calc==12 & baseline$Sexo==1)
baseline12years_female=subset(baseline,baseline$DN_Calc==12 & baseline$Sexo==2)

library(readr)
data <- read_csv("data/Banco_Geral_15022017.csv", col_types = cols(DN = col_date(format = "%m/%d/%Y"), Data_CP = col_date(format = "%m/%d/%Y"), Recrutamento = col_date(format = "%m/%d/%Y")))

data$DN_Calc=as.integer(floor(as.numeric(difftime(data$Recrutamento, data$DN, units="days")/365)))
7year_fix=c(422,490,502,510,648,687,915)

data[data$ID==422,]$DN_Calc=8
data[data$ID==490,]$DN_Calc=8
data[data$ID==502,]$DN_Calc=8
data[data$ID==510,]$DN_Calc=8
data[data$ID==648,]$DN_Calc=8
data[data$ID==687,]$DN_Calc=8
data[data$ID==915,]$DN_Calc=8

#ID 899 tem 14 anos mas vai ficar fora da analise

data=data[data$ID!=899,]

baseline=data[(is.na(data$Exclusao) | data$Exclusao=="Transferido") & !grepl("^C",data$Turma) & !is.na(data$ZIMC_0),]

baseline8years_male=subset(baseline,baseline$DN_Calc==8 & baseline$Sexo==1)
baseline8years_female=subset(baseline,baseline$DN_Calc==8 & baseline$Sexo==2)
baseline9years_male=subset(baseline,baseline$DN_Calc==9 & baseline$Sexo==1)
baseline9years_female=subset(baseline,baseline$DN_Calc==9 & baseline$Sexo==2)
baseline10years_male=subset(baseline,baseline$DN_Calc==10 & baseline$Sexo==1)
baseline10years_female=subset(baseline,baseline$DN_Calc==10 & baseline$Sexo==2)
baseline11years_male=subset(baseline,baseline$DN_Calc==11 & baseline$Sexo==1)
baseline11years_female=subset(baseline,baseline$DN_Calc==11 & baseline$Sexo==2)
baseline12years_male=subset(baseline,baseline$DN_Calc==12 & baseline$Sexo==1)
baseline12years_female=subset(baseline,baseline$DN_Calc==12 & baseline$Sexo==2)

baseline8years_male_anthro = subset(baseline8years_male[!is.na(baseline8years_male$C._Cintura_1) & !is.na(baseline8years_male$C._Quadril_1) & !is.na(baseline8years_male$C._Pescoco_1) | baseline8years_male$ID==774,], select=c("C._Cintura_1", "C._Quadril_1", "C._Pescoco_1","Perc_Gordura_1","Peso_0","Altura_0","Gordura_Kg_1","MM_Kg_1","TMB_1","Agua_corpo_l_1","Perc_Peso_do_corpo_1","Perc_MM_1","Bioresistencia_1","Reatancia_1"))

baseline8years_female_anthro = baseline8years_female[!is.na(baseline8years_female$C._Cintura_1) & !is.na(baseline8years_female$C._Quadril_1) & !is.na(baseline8years_female$C._Pescoco_1) | baseline8years_female$ID==770,]
baseline8years_female_anthro[baseline8years_female_anthro$ID==770,]$C_Cintura_1=NA
baseline8years_female_anthro=subset(baseline8years_female_anthro, select=c("C._Cintura_1", "C._Quadril_1", "C._Pescoco_1","Perc_Gordura_1","Peso_0","Altura_0","Gordura_Kg_1","MM_Kg_1","TMB_1","Agua_corpo_l_1","Perc_Peso_do_corpo_1","Perc_MM_1","Bioresistencia_1","Reatancia_1"))

baseline9years_male_anthro = subset(baseline9years_male[!is.na(baseline9years_male$C._Cintura_1) & !is.na(baseline9years_male$C._Quadril_1) & !is.na(baseline9years_male$C._Pescoco_1) | baseline9years_male$ID==487,],select=c("C._Cintura_1", "C._Quadril_1", "C._Pescoco_1","Perc_Gordura_1","Peso_0","Altura_0","Gordura_Kg_1","MM_Kg_1","TMB_1","Agua_corpo_l_1","Perc_Peso_do_corpo_1","Perc_MM_1","Bioresistencia_1","Reatancia_1"))

impBaseline8years_male_anthro = mice(baseline8years_male_anthro, m=50, maxit=300)
impBaseline8years_female_anthro = mice(baseline8years_female_anthro, m=50, maxit=300)
impBaseline9years_male_anthro = mice(baseline9years_male_anthro, m=50, maxit=300)

library(mice)

impBaseline8years_male_anthro = mice(baseline8years_male_anthro, m=50, maxit=300)
impBaseline8years_female_anthro = mice(baseline8years_female_anthro, m=50, maxit=300)
impBaseline9years_male_anthro = mice(baseline9years_male_anthro, m=50, maxit=300)

densityplot(impBaseline8years_male_anthro)
modelFit8yrs_male_anthro=with(impBaseline8years_male_anthro,lm(Bioresistência_1 ~ C._Cintura_1+C._Quadril_1+C._Pescoco_1+Água_corpo_l_1))
pool_8years_male_anthro=pool(modelFit8yrs_male_anthro)
summary(pool_8years_male_anthro)
modelFit8yrs_male_anthro=with(impBaseline8years_male_anthro,lm(Bioresistencia_1 ~ C._Cintura_1+C._Quadril_1+C._Pescoco_1+Agua_corpo_l_1))
pool_8years_male_anthro=pool(modelFit8yrs_male_anthro)
summary(pool_8years_male_anthro)
modelFit8yrs_male_anthro=with(impBaseline8years_male_anthro,lm(Bioresistencia_1 ~ C._Cintura_1+C._Quadril_1+C._Pescoco_1))
pool_8years_male_anthro=pool(modelFit8yrs_male_anthro)
summary(pool_8years_male_anthro)
modelFit8yrs_female_anthro=with(impBaseline8years_female_anthro,lm(Bioresistencia_1 ~ C._Cintura_1+C._Quadril_1+C._Pescoco_1))
pool_8years_female_anthro=pool(modelFit8yrs_female_anthro)
summary(pool_8years_female_anthro)

modelFit9yrs_male_anthro=with(impBaseline9years_male_anthro,lm(Bioresistencia_1 ~ C._Cintura_1+C._Quadril_1+C._Pescoco_1))
pool_9years_male_anthro=pool(modelFit9yrs_male_anthro)
summary(pool_9years_male_anthro)

impBaseline8years_male_anthro$imp
complete8years_male_anthro=complete(impBaseline8years_male_anthro)
complete8years_female_anthro=complete(impBaseline8years_female_anthro)
complete9years_male_anthro=complete(impBaseline9years_male_anthro)
length(baseline)
length(baseline$Nome)
length(data$Nome)
q()
y
